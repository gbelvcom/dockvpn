#!/bin/bash

echo "üîß –û—Ç–∫–ª—é—á–µ–Ω–∏–µ –∑–∞—â–∏—Ç—ã –∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–≥–æ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–∞..."

# –û—Ç–∫–ª—é—á–∞–µ–º PF (–±—Ä–∞–Ω–¥–º–∞—É—ç—Ä)
sudo pfctl -d
echo "‚úÖ PF (–±—Ä–∞–Ω–¥–º–∞—É—ç—Ä) –æ—Ç–∫–ª—é—á–µ–Ω."

# –û–ø—Ä–µ–¥–µ–ª—è–µ–º VPN-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
VPN_IF=$(ifconfig | grep -o "utun[0-9]" | tail -n 1)

if [[ -n "$VPN_IF" ]]; then
    # –û–ø—Ä–µ–¥–µ–ª—è–µ–º VPN-—à–ª—é–∑
    VPN_GATEWAY=$(netstat -rn | grep "^default" | grep "$VPN_IF" | awk '{print $2}')

    # –£–¥–∞–ª—è–µ–º –º–∞—Ä—à—Ä—É—Ç —á–µ—Ä–µ–∑ VPN
    if [[ -n "$VPN_GATEWAY" ]]; then
        sudo route delete default "$VPN_GATEWAY"
        echo "‚úÖ –ú–∞—Ä—à—Ä—É—Ç —á–µ—Ä–µ–∑ VPN ($VPN_GATEWAY) —É–¥–∞–ª—ë–Ω."
    fi
else
    echo "‚ö† –ù–µ –Ω–∞–π–¥–µ–Ω VPN-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å. –í–æ–∑–º–æ–∂–Ω–æ, VPN —É–∂–µ –æ—Ç–∫–ª—é—á–µ–Ω."
fi

# –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π –∏–Ω—Ç–µ—Ä–Ω–µ—Ç (Wi-Fi / Ethernet)
DEFAULT_GATEWAY=$(netstat -rn | grep default | grep -E "en[0-9]" | awk '{print $2}' | head -n 1)

if [[ -n "$DEFAULT_GATEWAY" ]]; then
    sudo route add default "$DEFAULT_GATEWAY"
    echo "‚úÖ –ò–Ω—Ç–µ—Ä–Ω–µ—Ç –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω —á–µ—Ä–µ–∑ $DEFAULT_GATEWAY"
else
    echo "‚ö† –ù–µ —É–¥–∞–ª–æ—Å—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –º–∞—Ä—à—Ä—É—Ç! –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ Wi-Fi –∏–ª–∏ Ethernet."
fi

echo "‚úÖ –ó–∞—â–∏—Ç–∞ –æ—Ç–∫–ª—é—á–µ–Ω–∞. –ò–Ω—Ç–µ—Ä–Ω–µ—Ç —Ä–∞–±–æ—Ç–∞–µ—Ç –±–µ–∑ VPN."
